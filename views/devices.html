<!DOCTYPE html>
<html lang="en">

{{>head}}

<body class="hold-transition sidebar-mini layout-fixed">
    <div class="content-wrapper">
        <div class="wrapper">

            <!-- Navbar -->
            {{>navbar}}
            <!-- /.navbar -->
            <!-- Main Sidebar Container -->
            {{>sidebar}}
            <!-- Content Wrapper. Contains page content -->
            <div class="card card-primary">
                <div class="card-header">
                    <h3 class="card-title">Cihazlar Tablosu</h3>
                </div>
                <!-- /.card-header -->
                <!-- form start -->
                <form action="/device" method="POST">
                    <div class="card-body">
                        <div class="form-group">
                            <label for="exampleInputEmail1">Cihaz Adı</label>
                            <input type="text" class="form-control" id="devicename" name="devicename"
                                placeholder="Cihaz Adı">


                        </div>
                        <!-- /.card-body -->

                        <div class="card-footer">

                            <button type="submit" class="btn btn-primary" id="cihazEkle">Ekle</button>
                        </div>
                </form>
            </div>

            <div class="row">
                <div class="col">
                    <div class="card ">
                        <!-- Card header -->
                        <div class="card-header border-0">
                            <h3 class="mb-0">Cihazlar Listesi</h3>
                            <div class="topnav">

                                <input type="text" placeholder="Arama..">
                            </div>
                        </div>
                        <!-- Light table -->
                        <div class="table-responsive">
                            <table class="table align-items-center table-flush">
                                <thead class="thead-light">
                                    <tr>
                                        <th scope="col" class="sort" data-sort="name">Cihaz Adı</th>


                                    </tr>
                                </thead>


                                <tbody class="list">
                                    {{#each result}}
                                    <tr>
                                        <th scope="row">
                                            <span class="name mb-0 text-sm">{{devicename}}</span>
                                        </th>

                                        <td class="text-right">
                                            <div class="dropdown">
                                                <a href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                                                    aria-expanded="false">
                                                    <i class="fas fa-ellipsis-v"></i>
                                                </a>
                                                <div class="dropdown-menu dropdown-menu-right dropdown-menu-arrow">
                                                    <a class="dropdown-item"
                                                        onclick="openModal('{{devicecode}}','{{devicename}}')">Model
                                                        Ekle</a>
                                                    <a class="dropdown-item" href="/device/{{devicecode}}">Cihaz Sil</a>


                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    {{/each}}

                                </tbody>
                            </table>
                        </div>




                        <!-- Cihaz Modelleri -->
                        <div id="cihazmodelmodal" class="modal">

                            <!-- Modal content -->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <span class="cihazmodelclose">&times;</span>
                                    <h2>Cihaz Modelleri</h2>
                                </div>
                                <div class="modal-body">
                                    <!-- <form action="devicemodel" method="POST"> -->
                                    <div class="card-body">
                                        <h5 style="color: steelblue;"><label id="lblDeviceName"></label> Cihazına
                                            Ait Modeller</h5>
                                        <div class="form-group">
                                            <label for="txtModelName">Cihaz Modeli</label>
                                            <input type="text" class="form-control" id="txtModelName"
                                                placeholder="Cihaz Modeli">
                                            <input type="hidden" id="hdnModelCode" name="hdnModelCode">
                                        </div>


                                        <div class="col-6 text-right">
                                            <button class="btn btn-neutral btn-primary" id="btnModelAdd">Ekle</button>
                                        </div>

                                    </div>
                                    <!-- </form> -->

                                    <br>
                                    <h3 style="text-align: center;">Model Listesi</h3>

                                    <h5 style="text-align: right; margin-right: 122px;"> Arama Alanı:</h5>
                                    <div class="topnav">

                                        <input type="text" placeholder="Arama..">
                                    </div>

                                    <div class="table-responsive">
                                        <table class="table align-items-center table-flush">
                                            <thead class="thead-light">
                                                <tr>
                                                    <th scope="col" class="sort" data-sort="name">Cihaz Adı</th>
                                                    <th scope="col" class="sort" data-sort="name">Cihaz Modeli</th>



                                                    <th scope="col"></th>
                                                </tr>
                                            </thead>
                                            <tbody class="list" id="model-modal">



                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <!-- /.card-body -->


                            </div>


                        </div>





                        <script>

                            // Get the modal
                            function openModal(a, b) {
                                $("#lblDeviceName").empty().append(b);
                                $("#hdnModelCode").val(a);
                                var tbody = $("#model-modal");
                                tbody.empty();
                                $.get("/devicemodel/" + a, function (data) {
                                    tbody.append(data);

                                });
                                cihazmodelmodal.style.display = "block";

                            }
                            $("#btnModelAdd").on('click', function () {
                                var modelName = $("#txtModelName").val();

                                $("#txtModelName").val("");
                                var deviceCode = $('#hdnModelCode').val();

                                $.post('/devicemodel', { modelname: modelName, devicecode: deviceCode }, function (data) {
                                    $.get("/devicemodel/" + deviceCode, function (data) {
                                        $("#model-modal").empty().append(data);
                                    });
                                });
                                // var posting = $.post('/devicemodel', { modelname: modelName, devicecode: deviceCode });

                                // // Put the results in a div
                                // posting.done(function (data) {
                                //     alert("test");
                                //     var content = $(data).find("#content");
                                //     console.log(content);

                                //     $.get("/devicemodel/" + deviceCode, function (data) {
                                //         $("#model-modal").empty().append(data);
                                //     });
                                // });

                                // $.ajax({
                                //     url: '/devicemodel',
                                //     method: 'POST',
                                //     contentType: 'application/json',
                                //     success: function (response) {
                                //         console.log(response);
                                //     }
                                // });
                            });
                            //document.getElementById("cihazmodelmodal");

                            // Get the button that opens the modal

                            var cihazmodelbutton = document.getElementById("cihazmodelbutton");

                            // Get the <span> element that closes the modal

                            var cihazmodelspan = document.getElementsByClassName("cihazmodelclose")[0];

                            // When the user clicks the button, open the modal 

                            /* cihazmodelbutton.onclick = function () {
                                 cihazmodelmodal.style.display = "block";
                             } */



                            // When the user clicks on <span> (x), close the modal
                            cihazmodelspan.onclick = function () {
                                cihazmodelmodal.style.display = "none";
                            }




                            // When the user clicks anywhere outside of the modal, close it
                            window.onclick = function (event) {
                                if (event.target == cihazmodelmodal) {
                                    cihazmodelmodal.style.display = "none";
                                }
                            }




                        </script>




                    </div>

                </div>

            </div>

            <!-- /.content-wrapper -->

            {{>footer}}
            <!-- Control Sidebar -->

        </div>
    </div>

</body>

</html>